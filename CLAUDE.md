# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Blue Bridge volunteer management system built with **Umbraco CMS v17.0.2** on **.NET 10.0**. The application manages volunteer ("frivillig") information including crew assignments, personal details, and work history. The project uses a two-project structure with a Web host and a separate Code class library.

## Build and Run Commands

### Prerequisites
- .NET 10.0 SDK (x64 architecture required for the Web project)
- SQL Server instance running at `.\dockersql,1433` (or update connection string in appsettings.json)

### Run the Application
```bash
dotnet run --project Web/Web.csproj
```

### Build the Solution
```bash
dotnet build Web/Web.csproj
dotnet build Code/Code.csproj
```

### Database Configuration
The application connects to SQL Server using the connection string in `Web/appsettings.json`:
- Server: `.\dockersql,1433`
- Database: `bluebridge-voluntier-2026`
- Integrated authentication disabled (uses SQL auth with sa account)

**Important**: `appsettings.json` contains database credentials. Never commit actual production credentials.

## Architecture

### Project Structure

**Web/** - Main Umbraco web application (.NET 10.0)
- `Program.cs` - Application entry point with Umbraco builder configuration
- `Views/` - Razor views for content types (Frontpage, Dashboard, Crew, CrewListe, login, signup)
- `Views/Partials/` - Reusable view components for blockgrid, blocklist, and singleblock
- `wwwroot/` - Static files and media assets
- `umbraco/` - Umbraco runtime data and generated models
- `umbraco/models/` - Auto-generated content models (DO NOT EDIT - managed by ModelsBuilder)

**Code/** - Shared class library (.NET 9.0)
- Currently contains only a placeholder `Class1.cs`
- Intended for shared business logic, services, and domain models

### Umbraco Configuration

#### Environment-Specific Settings

**Development** (`appsettings.Development.json`):
- Runtime Mode: Development
- ModelsBuilder: SourceCodeAuto (auto-generates models in `umbraco/models/`)
- HTTPS: Disabled
- Debug mode: Enabled
- Console logging enabled

**Production** (`appsettings.json`):
- Runtime Mode: Production
- ModelsBuilder: Nothing (models not regenerated)
- HTTPS: Enabled (enforced)
- Unattended upgrades: Enabled
- Content version cleanup: Enabled
- Concurrent logins: Disabled

#### ModelsBuilder
Umbraco uses ModelsBuilder Embedded (v17.0.2) to generate strongly-typed models from content types defined in the backoffice. Generated models are located in `Web/umbraco/models/` and follow the pattern `*.generated.cs`. These files are **auto-generated** - do not manually edit them.

To regenerate models after content type changes:
- In Development: Models regenerate automatically when ModelsMode is SourceCodeAuto
- In Production: Models must be generated during build/publish

### Content Types

The application defines custom content types with the "bbv" prefix:

**Document Types:**
- `BbvFrontpage` - Front page
- `BbvDashboard` - User dashboard
- `BbvCrewPage` - Individual crew page
- `BbvCrewList` - Crew listing page
- `BbvLoginPage` - Login page
- `BbvSignUp` - Sign-up page
- `BbvSiteSettings` - Global site settings

**Member Type:**
- `BbvMember` (Frivillig/Volunteer) with properties:
  - `FirstName` (Fornavn)
  - `LastName` (Efternavn)
  - `Birthdate` (FÃ¸dselsdato)
  - `Phone` (Telefon)
  - `Crews` - Content picker for crew assignment
  - `TidligereArbejdssteder` (Previous workplaces)

### View Rendering

Views inherit from `UmbracoViewPage` and use the auto-generated models from `Umbraco.Cms.Web.Common.PublishedModels` namespace. Common imports are defined in `Views/_ViewImports.cshtml`.

Block-based content uses partial views in:
- `Views/Partials/blockgrid/` - Block Grid layouts (area, areas, default, items)
- `Views/Partials/blocklist/` - Block List rendering (default)
- `Views/Partials/singleblock/` - Single block components

## Important Notes

### DO NOT Edit Generated Files
Never modify files in `Web/umbraco/models/` - they are regenerated by Umbraco's ModelsBuilder. To change content models, modify the content type definitions in the Umbraco backoffice.

### Target Framework Mismatch
The Web project targets .NET 10.0 while the Code project targets .NET 9.0. This may cause compatibility issues. Consider aligning both projects to the same framework version.

### Compression Disabled
The Web project has `<CompressionEnabled>false</CompressionEnabled>` set because Umbraco backoffice files are precompressed by Node.js build processes.

### Accessing Umbraco Backoffice
The backoffice is available at `/umbraco` when running the application. First-time setup may require configuring an admin user if the database is empty.

## Custom Features

### Member CSV Importer Dashboard

A custom dashboard located in the Members section allows administrators to import volunteer data from CSV files.

**Location:** Web/App_Plugins/MemberImporter/
**Controller:** Web/Controllers/MemberImportController.cs

**CSV Format:**
The importer expects a CSV file with the following columns:
- `Email` (required) - Used as the member username
- `Fornavn` - First name (maps to `firstName` property)
- `Efternavn` - Last name (maps to `lastName` property)
- `Telefon` - Phone number (maps to `phone` property)
- `Arbejdssteder` - Previous workplaces (maps to `tidligereArbejdssteder` property)

**Behavior:**
- Existing members (matched by email) are updated with new data
- New members are created with a random password (users must reset password)
- Members are created with the `bbvMember` member type
- The dashboard displays import results including success count, errors, and skipped rows
- Accessible only to admin users in the Members section of the backoffice

**To use:**
1. Navigate to Members section in Umbraco backoffice
2. Select the "Member CSV Importer" dashboard
3. Upload a CSV file matching the expected format
4. Review the import results
