@using Umbraco.Cms.Web.Common.PublishedModels
@using Umbraco.Cms.Core.Security
@using Umbraco.Cms.Core.Services
@using Code.Services
@using System.Text.RegularExpressions
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<BbvCrewPage>
@inject IMemberManager MemberManager
@inject IMemberService MemberService
@inject ICrewService CrewService
@functions {
    string HtmlToPlainText(string? html)
    {
        if (string.IsNullOrEmpty(html)) return "";

        // Replace </p> and <br> with newlines
        var text = Regex.Replace(html, @"</p>\s*<p>", "\n", RegexOptions.IgnoreCase);
        text = Regex.Replace(text, @"<br\s*/?>", "\n", RegexOptions.IgnoreCase);
        text = Regex.Replace(text, @"</p>", "\n", RegexOptions.IgnoreCase);

        // Remove all remaining HTML tags
        text = Regex.Replace(text, @"<[^>]*>", "");

        // Decode HTML entities
        text = System.Net.WebUtility.HtmlDecode(text);

        // Trim extra whitespace and newlines
        text = text.Trim();

        return text;
    }
}
@{
    Layout = null;

    var currentMember = await MemberManager.GetCurrentMemberAsync();
    CrewDetailData? crewData = null;
    CrewViewMode viewMode = CrewViewMode.Volunteer;

    if (currentMember != null)
    {
        viewMode = await CrewService.GetMemberCrewViewModeAsync(currentMember.Email!, Model.Id);
        crewData = await CrewService.GetCrewDetailAsync(Model.Id, currentMember.Email!, viewMode);
    }

    var viewModeLabel = viewMode switch
    {
        CrewViewMode.Admin => "Administrator",
        CrewViewMode.Scheduler => "Vagtplanlægger",
        _ => "Frivillig"
    };

    var viewModeColor = viewMode switch
    {
        CrewViewMode.Admin => "bg-red-500",
        CrewViewMode.Scheduler => "bg-purple-500",
        _ => "bg-green-500"
    };

    var canEdit = viewMode == CrewViewMode.Admin || viewMode == CrewViewMode.Scheduler;
    var crewSuccess = TempData["CrewSuccess"] as string;
    var crewError = TempData["CrewError"] as string;
}
<!DOCTYPE html>
<html lang="da" class="h-full bg-slate-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@Model.Name - Blue Bridge Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .bg-blue-bridge { background-color: #23297A; }
        .text-blue-bridge { color: #23297A; }
        .bg-accent-yellow { background-color: #FFF000; }
        .border-blue-bridge { border-color: #23297A; }
        .prose p { margin-bottom: 1rem; }
        .prose ul { list-style: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose ol { list-style: decimal; margin-left: 1.5rem; margin-bottom: 1rem; }
    </style>
</head>
<body class="h-full">

@if (currentMember == null)
{
    <!-- Not logged in -->
    <div class="min-h-screen flex items-center justify-center bg-slate-50">
        <div class="text-center">
            <div class="h-12 w-auto bg-blue-bridge flex items-center justify-center text-white font-bold p-2 rounded mx-auto max-w-xs mb-8">
                BLUE BRIDGE <span class="ml-2 font-light text-xs tracking-widest uppercase">Portal</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Du skal være logget ind</h2>
            <p class="text-gray-600 mb-6">Log ind for at se crew detaljer</p>
            <a href="/login" class="inline-block bg-accent-yellow text-blue-bridge px-6 py-3 rounded-md font-bold uppercase tracking-wider hover:opacity-90">
                Log ind
            </a>
        </div>
    </div>
}
else if (crewData == null)
{
    <!-- No access or crew not found -->
    <div class="min-h-screen flex items-center justify-center bg-slate-50">
        <div class="text-center">
            <svg class="mx-auto h-16 w-16 text-gray-300 mb-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
            </svg>
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Ingen adgang</h2>
            <p class="text-gray-600 mb-6">Du har ikke adgang til dette crew, eller det findes ikke.</p>
            <a href="/frivillig/crews/" class="text-blue-bridge hover:opacity-80 font-semibold">Tilbage til crews &rarr;</a>
        </div>
    </div>
}
else
{
    @await Html.PartialAsync("Partials/_Navigation")

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-start justify-between">
                <div>
                    <div class="flex items-center space-x-3 mb-2">
                        <a href="/frivillig/crews/" class="text-gray-500 hover:text-gray-700">
                            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                            </svg>
                        </a>
                        <span class="text-gray-400">/</span>
                        <span class="text-gray-600 text-sm">@crewData.Name</span>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900">@crewData.Name</h1>
                    @if (crewData.AgeLimit.HasValue && crewData.AgeLimit.Value > 0)
                    {
                        <span class="inline-block mt-2 bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full">
                            Aldersgrænse: @crewData.AgeLimit+ år
                        </span>
                    }
                </div>
                <div class="flex items-center space-x-3">
                    @if (canEdit)
                    {
                        <button type="button" onclick="openEditModal()" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <svg class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                            </svg>
                            Rediger
                        </button>
                    }
                    <span class="@viewModeColor text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">
                        @viewModeLabel
                    </span>
                </div>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(crewSuccess))
        {
            <div class="mb-6 rounded-md bg-green-50 p-4">
                <div class="flex">
                    <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                    </svg>
                    <p class="ml-3 text-sm font-medium text-green-800">@crewSuccess</p>
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(crewError))
        {
            <div class="mb-6 rounded-md bg-red-50 p-4">
                <div class="flex">
                    <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                    </svg>
                    <p class="ml-3 text-sm font-medium text-red-800">@crewError</p>
                </div>
            </div>
        }

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Column -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Description -->
                @if (!string.IsNullOrEmpty(crewData.DescriptionHtml))
                {
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="bg-blue-bridge px-6 py-4">
                            <h2 class="text-xl font-bold text-white">Om dette crew</h2>
                        </div>
                        <div class="p-6 prose max-w-none text-gray-700">
                            @Html.Raw(crewData.DescriptionHtml)
                        </div>
                    </div>
                }

                @if (viewMode == CrewViewMode.Admin || viewMode == CrewViewMode.Scheduler)
                {
                    <!-- Assigned Members (Admin/Scheduler only) -->
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="bg-green-600 px-6 py-4 flex items-center justify-between">
                            <h2 class="text-xl font-bold text-white">Tildelte frivillige</h2>
                            <span class="bg-white/20 text-white text-sm px-3 py-1 rounded-full">
                                @crewData.Members.Count @(crewData.Members.Count == 1 ? "frivillig" : "frivillige")
                            </span>
                        </div>
                        <div class="p-6">
                            @if (crewData.Members.Any())
                            {
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead>
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Navn</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefon</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            @foreach (var member in crewData.Members)
                                            {
                                                <tr class="hover:bg-gray-50">
                                                    <td class="px-4 py-4 whitespace-nowrap">
                                                        <div class="flex items-center">
                                                            <div class="h-8 w-8 rounded-full bg-green-100 flex items-center justify-center text-green-700 text-sm font-bold mr-3">
                                                                @(member.FullName.Length > 0 ? member.FullName[0].ToString().ToUpper() : "?")
                                                            </div>
                                                            <span class="font-medium text-gray-900">@member.FullName</span>
                                                        </div>
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">
                                                        <a href="mailto:@member.Email" class="hover:text-blue-bridge">@member.Email</a>
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">
                                                        @if (!string.IsNullOrEmpty(member.Phone))
                                                        {
                                                            <a href="tel:@member.Phone" class="hover:text-blue-bridge">@member.Phone</a>
                                                        }
                                                        else
                                                        {
                                                            <span class="text-gray-400">-</span>
                                                        }
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap">
                                                        @if (member.HasAccepted2026)
                                                        {
                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                                <svg class="mr-1 h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
                                                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                                                </svg>
                                                                Bekræftet
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                                                                <svg class="mr-1 h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
                                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                                                </svg>
                                                                Afventer
                                                            </span>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            else
                            {
                                <div class="text-center py-8">
                                    <svg class="mx-auto h-12 w-12 text-gray-300" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                                    </svg>
                                    <h3 class="mt-4 text-sm font-semibold text-gray-900">Ingen frivillige tildelt</h3>
                                    <p class="mt-1 text-sm text-gray-500">Der er endnu ikke tildelt frivillige til dette crew.</p>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Wishlist Members (Admin/Scheduler only) -->
                    @if (crewData.WishlistMembers.Any())
                    {
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <div class="bg-amber-500 px-6 py-4 flex items-center justify-between">
                                <h2 class="text-xl font-bold text-white">Ønsker dette crew</h2>
                                <span class="bg-white/20 text-white text-sm px-3 py-1 rounded-full">
                                    @crewData.WishlistMembers.Count @(crewData.WishlistMembers.Count == 1 ? "person" : "personer")
                                </span>
                            </div>
                            <div class="p-6">
                                <p class="text-sm text-gray-600 mb-4">
                                    Disse frivillige har dette crew på deres ønskeliste og er ikke tildelt et crew endnu.
                                </p>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead>
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Navn</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefon</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Handling</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            @foreach (var member in crewData.WishlistMembers)
                                            {
                                                <tr class="hover:bg-gray-50">
                                                    <td class="px-4 py-4 whitespace-nowrap">
                                                        <div class="flex items-center">
                                                            <div class="h-8 w-8 rounded-full bg-amber-100 flex items-center justify-center text-amber-700 text-sm font-bold mr-3">
                                                                @(member.FullName.Length > 0 ? member.FullName[0].ToString().ToUpper() : "?")
                                                            </div>
                                                            <span class="font-medium text-gray-900">@member.FullName</span>
                                                        </div>
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">
                                                        <a href="mailto:@member.Email" class="hover:text-blue-bridge">@member.Email</a>
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">
                                                        @if (!string.IsNullOrEmpty(member.Phone))
                                                        {
                                                            <a href="tel:@member.Phone" class="hover:text-blue-bridge">@member.Phone</a>
                                                        }
                                                        else
                                                        {
                                                            <span class="text-gray-400">-</span>
                                                        }
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap">
                                                        @if (member.HasAccepted2026)
                                                        {
                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                                Bekræftet 2026
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                                Ikke bekræftet
                                                            </span>
                                                        }
                                                    </td>
                                                    <td class="px-4 py-4 whitespace-nowrap text-right">
                                                        <form method="post" action="/umbraco/surface/CrewSurface/AcceptMember" class="inline">
                                                            @Html.AntiForgeryToken()
                                                            <input type="hidden" name="crewId" value="@crewData.Id" />
                                                            <input type="hidden" name="memberId" value="@member.MemberId" />
                                                            <input type="hidden" name="returnUrl" value="@Context.Request.Path" />
                                                            <button type="submit" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                                                <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                                                                </svg>
                                                                Accepter
                                                            </button>
                                                        </form>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <!-- Volunteer View: Messages placeholder -->
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="bg-blue-bridge px-6 py-4">
                            <h2 class="text-xl font-bold text-white">Beskeder</h2>
                        </div>
                        <div class="p-6">
                            <div class="text-center py-8">
                                <svg class="mx-auto h-12 w-12 text-gray-300" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
                                </svg>
                                <h3 class="mt-4 text-sm font-semibold text-gray-900">Ingen beskeder endnu</h3>
                                <p class="mt-1 text-sm text-gray-500">Beskeder fra din crew-ansvarlige vil blive vist her.</p>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Contact Supervisors -->
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="bg-purple-600 px-6 py-4">
                        <h2 class="text-lg font-bold text-white">Kontakt</h2>
                    </div>
                    <div class="p-6 space-y-4">
                        @if (crewData.ScheduleSupervisor != null)
                        {
                            <div>
                                <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-2">Vagtplanlægger</h3>
                                <div class="bg-purple-50 rounded-lg p-4">
                                    <div class="flex items-center mb-2">
                                        <div class="h-10 w-10 rounded-full bg-purple-200 flex items-center justify-center text-purple-700 font-bold mr-3">
                                            @(crewData.ScheduleSupervisor.FullName.Length > 0 ? crewData.ScheduleSupervisor.FullName[0].ToString().ToUpper() : "?")
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900">@crewData.ScheduleSupervisor.FullName</p>
                                            <p class="text-xs text-purple-600">Vagtplanlægger</p>
                                        </div>
                                    </div>
                                    <div class="space-y-1 text-sm">
                                        <a href="mailto:@crewData.ScheduleSupervisor.Email" class="flex items-center text-gray-600 hover:text-purple-700">
                                            <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                                            </svg>
                                            @crewData.ScheduleSupervisor.Email
                                        </a>
                                        @if (!string.IsNullOrEmpty(crewData.ScheduleSupervisor.Phone))
                                        {
                                            <a href="tel:@crewData.ScheduleSupervisor.Phone" class="flex items-center text-gray-600 hover:text-purple-700">
                                                <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                                                </svg>
                                                @crewData.ScheduleSupervisor.Phone
                                            </a>
                                        }
                                    </div>
                                </div>
                            </div>
                        }

                        @if (crewData.Supervisors.Any())
                        {
                            <div>
                                <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-2">Ansvarlige</h3>
                                <div class="flex flex-wrap gap-2">
                                    @foreach (var supervisor in crewData.Supervisors)
                                    {
                                        <div class="inline-flex items-center bg-slate-100 rounded-full px-3 py-1.5">
                                            <div class="h-6 w-6 rounded-full bg-slate-300 flex items-center justify-center text-slate-700 text-xs font-bold mr-2">
                                                @(supervisor.FullName.Length > 0 ? supervisor.FullName[0].ToString().ToUpper() : "?")
                                            </div>
                                            <span class="text-sm font-medium text-gray-700">@supervisor.FullName</span>
                                        </div>
                                    }
                                </div>
                            </div>
                        }

                        @if (crewData.ScheduleSupervisor == null && !crewData.Supervisors.Any())
                        {
                            <div class="text-center py-4">
                                <svg class="mx-auto h-10 w-10 text-gray-300" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                                </svg>
                                <p class="mt-2 text-sm text-gray-500">Ingen kontaktpersoner angivet</p>
                            </div>
                        }
                    </div>
                </div>

                @if (viewMode == CrewViewMode.Admin || viewMode == CrewViewMode.Scheduler)
                {
                    <!-- Quick Stats (Admin/Scheduler) -->
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-lg font-bold text-gray-900">Statistik</h2>
                        </div>
                        <div class="p-6">
                            <dl class="grid grid-cols-2 gap-4">
                                <div class="bg-green-50 rounded-lg p-4 text-center">
                                    <dt class="text-xs font-medium text-green-600 uppercase tracking-wider">Tildelt</dt>
                                    <dd class="mt-1 text-2xl font-bold text-green-700">@crewData.Members.Count</dd>
                                </div>
                                <div class="bg-amber-50 rounded-lg p-4 text-center">
                                    <dt class="text-xs font-medium text-amber-600 uppercase tracking-wider">Ønsker</dt>
                                    <dd class="mt-1 text-2xl font-bold text-amber-700">@crewData.WishlistMembers.Count</dd>
                                </div>
                                <div class="bg-blue-50 rounded-lg p-4 text-center">
                                    <dt class="text-xs font-medium text-blue-600 uppercase tracking-wider">Bekræftet</dt>
                                    <dd class="mt-1 text-2xl font-bold text-blue-700">@crewData.Members.Count(m => m.HasAccepted2026)</dd>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4 text-center">
                                    <dt class="text-xs font-medium text-gray-600 uppercase tracking-wider">Afventer</dt>
                                    <dd class="mt-1 text-2xl font-bold text-gray-700">@crewData.Members.Count(m => !m.HasAccepted2026)</dd>
                                </div>
                            </dl>
                        </div>
                    </div>
                }
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-100 border-t border-slate-200 mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-sm text-gray-500">
                    &copy; @DateTime.Now.Year Blue Bridge Festival. Alle rettigheder forbeholdes.
                </div>
                <div class="mt-4 md:mt-0 flex space-x-6">
                    <a href="/contact" class="text-sm text-gray-500 hover:text-gray-900">Kontakt</a>
                    <a href="/privacy" class="text-sm text-gray-500 hover:text-gray-900">Privatlivspolitik</a>
                    <a href="/help" class="text-sm text-gray-500 hover:text-gray-900">Hjælp</a>
                </div>
            </div>
        </div>
    </footer>

    @if (canEdit)
    {
        <!-- Edit Modal -->
        <div id="editModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
            <div class="flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                <!-- Background overlay -->
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="closeEditModal()"></div>

                <!-- Modal panel -->
                <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                    <div class="absolute top-0 right-0 pt-4 pr-4">
                        <button type="button" onclick="closeEditModal()" class="bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                            <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                            </svg>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg font-semibold leading-6 text-gray-900" id="modal-title">
                                Rediger @crewData.Name
                            </h3>
                            <div class="mt-4">
                                <form method="post" action="/umbraco/surface/CrewSurface/UpdateCrewDetails" id="editCrewForm">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="crewId" value="@crewData.Id" />
                                    <input type="hidden" name="returnUrl" value="@Context.Request.Path" />

                                    <div class="space-y-4">
                                        <div>
                                            <label for="ageLimit" class="block text-sm font-medium text-gray-700">Aldersgrænse</label>
                                            <div class="mt-1 relative rounded-md shadow-sm">
                                                <input type="number" name="ageLimit" id="ageLimit" min="0" max="99"
                                                       value="@(crewData.AgeLimit ?? 0)"
                                                       class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3 border">
                                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                    <span class="text-gray-500 sm:text-sm">år</span>
                                                </div>
                                            </div>
                                            <p class="mt-1 text-xs text-gray-500">Sæt til 0 for ingen aldersgrænse</p>
                                        </div>

                                        <div>
                                            <label for="description" class="block text-sm font-medium text-gray-700">Beskrivelse</label>
                                            <div class="mt-1">
                                                <textarea name="description" id="description" rows="6"
                                                          class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3 border"
                                                          placeholder="Beskriv crewets opgaver og ansvar...">@HtmlToPlainText(crewData.DescriptionHtml)</textarea>
                                            </div>
                                            <p class="mt-1 text-xs text-gray-500">Beskrivelsen vises på crew-siden</p>
                                        </div>
                                    </div>

                                    <div class="mt-5 sm:mt-6 sm:flex sm:flex-row-reverse gap-3">
                                        <button type="submit"
                                                class="inline-flex w-full justify-center rounded-md bg-blue-bridge px-3 py-2 text-sm font-semibold text-white shadow-sm hover:opacity-90 sm:w-auto">
                                            Gem ændringer
                                        </button>
                                        <button type="button" onclick="closeEditModal()"
                                                class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">
                                            Annuller
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function openEditModal() {
                document.getElementById('editModal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeEditModal() {
                document.getElementById('editModal').classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            // Close modal on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeEditModal();
                }
            });
        </script>
    }
}

</body>
</html>
