@using Web.ViewModels;
@model AcceptInvitationViewModel
@{
    Layout = null;
    var invitationError = TempData["InvitationError"] as string;
    var hasError = !string.IsNullOrEmpty(invitationError) || Model.AvailableCrews.Count == 0;
}
<!DOCTYPE html>
<html lang="da" class="h-full bg-slate-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bliv frivillig igen - Blue Bridge 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .bg-blue-bridge { background-color: #23297A; }
        .text-blue-bridge { color: #23297A; }
        .bg-accent-yellow { background-color: #FFF000; }
        .crew-card {
            transition: all 0.2s ease;
        }
        .crew-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .crew-card.selected {
            border-color: #23297A;
            background-color: rgba(35, 41, 122, 0.05);
        }
    </style>
</head>
<body class="h-full">

<div class="min-h-full py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-2xl mx-auto">
        <div class="text-center mb-8">
            <div class="h-12 w-auto bg-blue-bridge flex items-center justify-center text-white font-bold p-2 rounded mx-auto max-w-xs">
                BLUE BRIDGE <span class="ml-2 font-light text-xs tracking-widest uppercase">Portal</span>
            </div>
        </div>

        @if (hasError)
        {
            <div class="bg-white py-8 px-6 shadow sm:rounded-lg">
                <div class="text-center">
                    <svg class="mx-auto h-12 w-12 text-red-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                    </svg>
                    <h2 class="mt-4 text-2xl font-bold text-gray-900">@(invitationError ?? "Der opstod en fejl")</h2>
                    <p class="mt-2 text-gray-600">Kontakt os venligst, hvis problemet fortsætter.</p>
                    <a href="/" class="mt-6 inline-block text-blue-bridge hover:opacity-80 font-semibold">Gå til forsiden</a>
                </div>
            </div>
        }
        else
        {
            <div class="bg-white py-8 px-6 shadow sm:rounded-lg">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Velkommen tilbage, @Model.FirstName!</h2>
                    <p class="mt-2 text-gray-600">
                        Vi vil gerne have dig med som frivillig til Blue Bridge Festival 2026.
                    </p>
                </div>

                <form asp-controller="InvitationSurface" asp-action="HandleAcceptInvitation" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="Token" value="@Model.Token" />

                    <!-- Personal Info Section -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Dine oplysninger</h3>

                        <div class="space-y-4">
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                                <input type="email"
                                       id="email"
                                       value="@Model.Email"
                                       disabled
                                       class="mt-1 block w-full rounded-md border-gray-300 bg-gray-100 py-2.5 px-3 text-gray-500 sm:text-sm">
                            </div>

                            <div>
                                <label for="birthdate" class="block text-sm font-medium text-gray-700">Fødselsdato <span class="text-red-500">*</span></label>
                                <input type="date"
                                       id="birthdate"
                                       name="Birthdate"
                                       value="@(Model.Birthdate?.ToString("yyyy-MM-dd"))"
                                       required
                                       class="mt-1 block w-full rounded-md border-0 py-2.5 px-3 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-800 sm:text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Password Section -->
                    <div class="mb-8 border-t pt-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Vælg adgangskode</h3>
                        <p class="text-sm text-gray-600 mb-4">
                            Vælg en adgangskode til din konto. Du kan bruge den til at logge ind og administrere dine vagter.
                        </p>

                        <div class="space-y-4">
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700">Adgangskode <span class="text-red-500">*</span></label>
                                <input type="password"
                                       id="password"
                                       name="Password"
                                       required
                                       minlength="10"
                                       autocomplete="new-password"
                                       class="mt-1 block w-full rounded-md border-0 py-2.5 px-3 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-800 sm:text-sm">
                                <p class="mt-1 text-xs text-gray-500">Mindst 10 tegn med store/små bogstaver, tal og specialtegn</p>
                            </div>

                            <div>
                                <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Bekræft adgangskode <span class="text-red-500">*</span></label>
                                <input type="password"
                                       id="confirmPassword"
                                       name="ConfirmPassword"
                                       required
                                       minlength="10"
                                       autocomplete="new-password"
                                       class="mt-1 block w-full rounded-md border-0 py-2.5 px-3 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-800 sm:text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Crew Selection Section -->
                    <div class="mb-8 border-t pt-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Vælg dine crew-ønsker</h3>
                        <p class="text-sm text-gray-600 mb-6">
                            Vælg de crews, du gerne vil arbejde i. Du kan vælge flere.
                        </p>

                        <div class="space-y-4">
                            @foreach (var crew in Model.AvailableCrews)
                            {
                                <label class="crew-card block p-4 border-2 border-gray-200 rounded-lg cursor-pointer">
                                    <div class="flex items-start">
                                        <div class="flex items-center h-6">
                                            <input type="checkbox"
                                                   name="SelectedCrewIds"
                                                   value="@crew.Id"
                                                   class="h-5 w-5 rounded border-gray-300 text-blue-bridge focus:ring-blue-800"
                                                   onchange="this.closest('.crew-card').classList.toggle('selected', this.checked)">
                                        </div>
                                        <div class="ml-4 flex-1">
                                            <div class="flex items-center justify-between">
                                                <span class="text-lg font-semibold text-gray-900">@crew.Name</span>
                                                @if (crew.AgeLimit.HasValue && crew.AgeLimit > 0)
                                                {
                                                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                                                        @crew.AgeLimit+ år
                                                    </span>
                                                }
                                            </div>
                                            @if (!string.IsNullOrEmpty(crew.Description))
                                            {
                                                <p class="mt-1 text-sm text-gray-600">@crew.Description</p>
                                            }
                                        </div>
                                    </div>
                                </label>
                            }
                        </div>
                    </div>

                    <div class="border-t pt-6">
                        <div class="flex items-start mb-6">
                            <div class="flex items-center h-6">
                                <input type="checkbox"
                                       id="confirmAccept"
                                       required
                                       class="h-5 w-5 rounded border-gray-300 text-blue-bridge focus:ring-blue-800">
                            </div>
                            <label for="confirmAccept" class="ml-3 text-sm text-gray-700">
                                Jeg bekræfter, at jeg gerne vil være frivillig til Blue Bridge Festival 2026
                            </label>
                        </div>

                        <button type="submit"
                                class="flex w-full justify-center rounded-md bg-accent-yellow px-4 py-3 text-sm font-bold leading-6 text-blue-bridge shadow-sm hover:opacity-90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-yellow-400 uppercase tracking-wider">
                            Ja, jeg vil være frivillig igen!
                        </button>
                    </div>
                </form>

                <p class="mt-6 text-center text-xs text-gray-500">
                    Ved at acceptere gemmer vi dine crew-ønsker. Vi kontakter dig med mere information.
                </p>
            </div>
        }
    </div>
</div>

</body>
</html>
